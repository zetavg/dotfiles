#!/usr/bin/env bash
# Launches Claude Code installed under the global Node.js.
# Also try to load environment variables from .env files in the current and parent directories.
# CLAUDE_CODE_BASE_URL and CLAUDE_CODE_AUTH_TOKEN, if set, override the standard Anthropic API setup.

set -euo pipefail

SCRIPT_PATH="${BASH_SOURCE[0]:-$0}"
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"


# 1. Environment variables

source "${SCRIPT_DIR}/utils/load_var_from_dotenv.sh" CLAUDE_CONFIG_DIR
source "${SCRIPT_DIR}/utils/load_var_from_dotenv.sh" ANTHROPIC_AUTH_TOKEN
source "${SCRIPT_DIR}/utils/load_var_from_dotenv.sh" ANTHROPIC_BASE_URL
source "${SCRIPT_DIR}/utils/load_var_from_dotenv.sh" CLAUDE_CODE_AUTH_TOKEN
source "${SCRIPT_DIR}/utils/load_var_from_dotenv.sh" CLAUDE_CODE_BASE_URL

[ -n "${CLAUDE_CODE_AUTH_TOKEN:-}" ] && export ANTHROPIC_AUTH_TOKEN="$CLAUDE_CODE_AUTH_TOKEN"
[ -n "${CLAUDE_CODE_BASE_URL:-}" ] && export ANTHROPIC_BASE_URL="$CLAUDE_CODE_BASE_URL"


# 2. Use claude installed under global Node.js version

source "${SCRIPT_DIR}/utils/find_global_command_path.sh"
claude_path=$(find_global_command_path "node" "claude" "npm install -g @anthropic-ai/claude-code" "$SCRIPT_PATH")


# 3. Execute claude with arguments passthrough

exec "$claude_path" "$@"
